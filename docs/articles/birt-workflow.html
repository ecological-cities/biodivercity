<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BIRT Workflow â€¢ biodivercity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="BIRT Workflow">
<meta property="og:description" content="biodivercity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biodivercity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/biodivercity.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/birt-workflow.html">BIRT Workflow</a>
    </li>
    <li>
      <a href="../articles/survey-methods.html">Survey methodology</a>
    </li>
    <li>
      <a href="../articles/otsu-thresholding.html">Otsu's thresholding</a>
    </li>
    <li>
      <a href="../articles/heatmap-resolutions.html">Alpha diversity heatmap comparisons</a>
    </li>
    <li>
      <a href="../articles/covid-19_missed-surveys.html">Missing surveys from COVID-19 measures</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="birt-workflow_files/header-attrs-2.11/header-attrs.js"></script><script src="birt-workflow_files/kePrint-0.0.1/kePrint.js"></script><link href="birt-workflow_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BIRT Workflow</h1>
                        <h4 class="author">Author</h4>
            
            <h4 class="date">2021-12-13</h4>
      
      
      <div class="hidden name"><code>birt-workflow.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The project objectives are to:</p>
<p>This package facilitates existing analyses</p>
</div>
<div id="pre-survey-preparations" class="section level2">
<h2 class="hasAnchor">
<a href="#pre-survey-preparations" class="anchor"></a>1. Pre-survey preparations</h2>
<div id="sampling-point-generation" class="section level3">
<h3 class="hasAnchor">
<a href="#sampling-point-generation" class="anchor"></a>Sampling point generation</h3>
<p>To generate random sampling points for the collection of new data, the research area is first randomly sampled at a specified point density. Land cover is stratified into two main classes of <em>natural vegetation</em> and <em>urban</em> land cover. These two land cover types are randomly sampled independently at a point density of one point per 50 hectares of land.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>

<span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/random_pt_gen.html">random_pt_gen</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-collection-format" class="section level3">
<h3 class="hasAnchor">
<a href="#data-collection-format" class="anchor"></a>Data collection format</h3>
<pre><code>#&gt; Warning: package 'kableExtra' was built under R version 4.1.2
#&gt; Warning: replacing previous import 'dplyr::collapse' by 'glue::collapse' when
#&gt; loading 'biodivercity'
#&gt; Warning: replacing previous import 'dplyr::intersect' by 'terra::intersect' when
#&gt; loading 'biodivercity'
#&gt; Warning: replacing previous import 'glue::trim' by 'terra::trim' when loading
#&gt; 'biodivercity'
#&gt; Warning: replacing previous import 'dplyr::src' by 'terra::src' when loading
#&gt; 'biodivercity'
#&gt; Warning: replacing previous import 'dplyr::union' by 'terra::union' when loading
#&gt; 'biodivercity'
#&gt; Warning: replacing previous import 'terra::res' by 'raster::res' when loading
#&gt; 'biodivercity'</code></pre>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped">
<caption style="font-size: initial !important;">
<strong>Sample survey data format</strong>
</caption>
<thead><tr>
<th style="text-align:left;">
survey_id
</th>
<th style="text-align:right;">
round
</th>
<th style="text-align:left;">
point_id
</th>
<th style="text-align:right;">
cycle
</th>
<th style="text-align:left;">
priority
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
town
</th>
<th style="text-align:left;">
resampled
</th>
<th style="text-align:left;">
landcover
</th>
<th style="text-align:left;">
isWater
</th>
<th style="text-align:left;">
isUGS
</th>
<th style="text-align:left;">
isConey
</th>
<th style="text-align:left;">
date
</th>
<th style="text-align:left;">
start_time
</th>
<th style="text-align:left;">
recorder
</th>
<th style="text-align:left;">
time
</th>
<th style="text-align:left;">
taxon
</th>
<th style="text-align:left;">
species
</th>
<th style="text-align:left;">
family
</th>
<th style="text-align:left;">
genus
</th>
<th style="text-align:right;">
abundance
</th>
<th style="text-align:right;">
dist_m
</th>
<th style="text-align:left;">
notes
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1 QTNa14a_P 1 Odonata
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNa14a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 14:00:00
</td>
<td style="text-align:left;">
Chloe
</td>
<td style="text-align:left;">
2016-08-04 14:01:00
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
Rhyothemis phyllis
</td>
<td style="text-align:left;">
Libellulidae
</td>
<td style="text-align:left;">
Rhyothemis spp.
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1 QTNa14a_P 1 Odonata
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNa14a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 14:00:00
</td>
<td style="text-align:left;">
Chloe
</td>
<td style="text-align:left;">
2016-08-04 14:12:00
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
Crocothemis servilia
</td>
<td style="text-align:left;">
Libellulidae
</td>
<td style="text-align:left;">
Crocothemis spp.
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SH4505
</td>
</tr>
<tr>
<td style="text-align:left;">
1 QTNa14a_P 1 Odonata
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNa14a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 14:00:00
</td>
<td style="text-align:left;">
Chloe
</td>
<td style="text-align:left;">
2016-08-04 14:15:00
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
Neurothemis fluctuans
</td>
<td style="text-align:left;">
Libellulidae
</td>
<td style="text-align:left;">
Neurothemis spp.
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1 QTNa14a_P 1 Odonata
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNa14a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 14:00:00
</td>
<td style="text-align:left;">
Chloe
</td>
<td style="text-align:left;">
2016-08-04 14:23:00
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
Crocothemis servilia
</td>
<td style="text-align:left;">
Libellulidae
</td>
<td style="text-align:left;">
Crocothemis spp.
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
CT0017 SH4519
</td>
</tr>
<tr>
<td style="text-align:left;">
1 QTNa14a_P 1 Odonata
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNa14a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 14:00:00
</td>
<td style="text-align:left;">
Chloe
</td>
<td style="text-align:left;">
2016-08-04 14:28:00
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
Neurothemis fluctuans
</td>
<td style="text-align:left;">
Libellulidae
</td>
<td style="text-align:left;">
Neurothemis spp.
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1 QTNb1a_P 1 Odonata
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNb1a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Nat veg
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 14:44:00
</td>
<td style="text-align:left;">
Chloe
</td>
<td style="text-align:left;">
2016-08-04 14:44:00
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
Neurothemis fluctuans
</td>
<td style="text-align:left;">
Libellulidae
</td>
<td style="text-align:left;">
Neurothemis spp.
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
SH4530 CT0027
</td>
</tr>
</tbody>
</table>
</div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped">
<caption style="font-size: initial !important;">
<strong>Sample survey info format</strong>
</caption>
<thead><tr>
<th style="text-align:left;">
survey_id
</th>
<th style="text-align:right;">
round
</th>
<th style="text-align:left;">
point_id
</th>
<th style="text-align:right;">
cycle
</th>
<th style="text-align:left;">
priority
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
town
</th>
<th style="text-align:left;">
resampled
</th>
<th style="text-align:left;">
landcover
</th>
<th style="text-align:left;">
isWater
</th>
<th style="text-align:left;">
isUGS
</th>
<th style="text-align:left;">
isConey
</th>
<th style="text-align:left;">
date
</th>
<th style="text-align:left;">
start_time
</th>
<th style="text-align:left;">
surveyors
</th>
<th style="text-align:left;">
weather
</th>
<th style="text-align:left;">
weather_station
</th>
<th style="text-align:right;">
rain_lastdate
</th>
<th style="text-align:right;">
rain_dailytotal_mm
</th>
<th style="text-align:right;">
rain_highest30min_mm
</th>
<th style="text-align:right;">
rain_highest60min_mm
</th>
<th style="text-align:right;">
rain_highest120min_mm
</th>
<th style="text-align:left;">
notes
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1 QTNa14a_P 1 Odonata
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNa14a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 14:00:00
</td>
<td style="text-align:left;">
Chloe, Sherry
</td>
<td style="text-align:left;">
Fair
</td>
<td style="text-align:left;">
Queenstown
</td>
<td style="text-align:right;">
20160803
</td>
<td style="text-align:right;">
9.6
</td>
<td style="text-align:right;">
6.2
</td>
<td style="text-align:right;">
8.6
</td>
<td style="text-align:right;">
9.0
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1 QTNb1a_P 1 Odonata
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNb1a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Odonata
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Nat veg
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 14:44:00
</td>
<td style="text-align:left;">
Chloe, Sherry
</td>
<td style="text-align:left;">
Fair
</td>
<td style="text-align:left;">
Queenstown
</td>
<td style="text-align:right;">
20160803
</td>
<td style="text-align:right;">
9.6
</td>
<td style="text-align:right;">
6.2
</td>
<td style="text-align:right;">
8.6
</td>
<td style="text-align:right;">
9.0
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1 QTNa14a_P 1 Amphibia
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNa14a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Amphibia
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 19:55:00
</td>
<td style="text-align:left;">
Chloe, Sherry, Marcus, Jacqueline
</td>
<td style="text-align:left;">
Fair
</td>
<td style="text-align:left;">
Queenstown
</td>
<td style="text-align:right;">
20160803
</td>
<td style="text-align:right;">
9.6
</td>
<td style="text-align:right;">
6.2
</td>
<td style="text-align:right;">
8.6
</td>
<td style="text-align:right;">
9.0
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1 QTNb1a_P 1 Amphibia
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
QTNb1a_P
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Amphibia
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Nat veg
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-04
</td>
<td style="text-align:left;">
2016-08-04 20:40:00
</td>
<td style="text-align:left;">
Chloe, Sherry, Marcus, Jacqueline
</td>
<td style="text-align:left;">
Fair
</td>
<td style="text-align:left;">
Queenstown
</td>
<td style="text-align:right;">
20160803
</td>
<td style="text-align:right;">
9.6
</td>
<td style="text-align:right;">
6.2
</td>
<td style="text-align:right;">
8.6
</td>
<td style="text-align:right;">
9.0
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1 PGT15 1 Aves
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
PGT15
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Aves
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
PG
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-08
</td>
<td style="text-align:left;">
2016-08-08 07:00:00
</td>
<td style="text-align:left;">
Chloe, Sherry
</td>
<td style="text-align:left;">
Partly cloudy
</td>
<td style="text-align:left;">
Punggol
</td>
<td style="text-align:right;">
20160807
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1 PGT14 1 Aves
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
PGT14
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Aves
</td>
<td style="text-align:left;">
2016/17
</td>
<td style="text-align:left;">
PG
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Urban
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
2016-08-08
</td>
<td style="text-align:left;">
2016-08-08 07:33:00
</td>
<td style="text-align:left;">
Chloe, Sherry
</td>
<td style="text-align:left;">
Partly cloudy
</td>
<td style="text-align:left;">
Punggol
</td>
<td style="text-align:right;">
20160807
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="process-survey-data" class="section level2">
<h2 class="hasAnchor">
<a href="#process-survey-data" class="anchor"></a>2. Process survey data</h2>
<p>Collected fauna survey data in the format detailed in the previous section can be easily subset with respect to <code>town</code>, <code>round</code> and/or <code>priority</code> with the <code>filter_obs</code> function. For example, a specific set of surveys (i.e.Â butterfly surveys in Tampines from 2020-2021) can be filtered as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">fauna</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span>

<span class="va">butterflies_tampines_round_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_obs.html">filter_obs</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">fauna</span>, survey_ref <span class="op">=</span> <span class="va">surveys</span>,
                   specify_taxon <span class="op">=</span> <span class="st">"Lepidoptera"</span>,
                   specify_area <span class="op">=</span> <span class="st">"TP"</span>,
                   specify_period <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></code></pre></div>
<p>Checks are then performed to remove uncertain fauna identifications to prevent over-counting.</p>
<p>Next, the surveys are then filtered to remove all surveys at sampling points that are surveyed less than three times. The remaining surveys are normalised by randomly removing sampling points from sampling zones to achieve similar point densities across all areas. Three surveys are then randomly selected per sampling point and taxon, and the removal process is repeated 30 times to obtain bootstrapped results. This normalised dataset is used to summarise species richness and species accumulation curves across sampling areas:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># BY POINT</span>
<span class="va">normalised_perpt</span> <span class="op">&lt;-</span> 
  <span class="fu">foreach</span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">fauna_normalised</span><span class="op">)</span>, 
          .packages <span class="op">=</span> <span class="st">"tidyverse"</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
 
  <span class="co">#get unique data to input to loop later</span>
  <span class="va">unique</span> <span class="op">&lt;-</span> <span class="va">surveys_normalised</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="va">town</span>, <span class="va">round</span>, <span class="va">priority</span><span class="op">)</span>
  
  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">unique</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
    <span class="va">sptally_data</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="../reference/sptally_extractor.html">sptally_extractor</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">fauna_normalised</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                        survey_ref <span class="op">=</span> <span class="va">surveys_normalised</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                        specify_town <span class="op">=</span> <span class="va">unique</span><span class="op">$</span><span class="va">town</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, 
                        specify_round <span class="op">=</span> <span class="va">unique</span><span class="op">$</span><span class="va">round</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, 
                        specify_priority <span class="op">=</span> <span class="va">unique</span><span class="op">$</span><span class="va">priority</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,
                        level <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span>
    
    <span class="co"># bind to plot_sac &amp; overwrite</span>
    <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">%&gt;%</span>
      <span class="fu">bind_rows</span><span class="op">(</span><span class="va">sptally_data</span><span class="op">)</span>
    
    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">sptally_data</span><span class="op">)</span>
  <span class="op">}</span>
            
  <span class="va">results</span>                     
<span class="op">}</span>

<span class="co"># summarise &amp; stats</span>
<span class="va">normalised_perpt</span> <span class="op">&lt;-</span> <span class="va">normalised_perpt</span> <span class="op">%&gt;%</span> 
  <span class="fu">map_dfr</span><span class="op">(</span><span class="op">~</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, .id <span class="op">=</span> <span class="st">"iteration"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># unlist </span>
  <span class="fu">mutate</span><span class="op">(</span>iteration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">iteration</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
  <span class="co"># add iteration-level summaries</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">iteration</span>, 
           <span class="va">town</span>, <span class="va">round</span>, <span class="va">priority</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="co">#,</span>
            <span class="co">#se = sd(n, na.rm = T)/sqrt(length(n))</span>
            <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"Point"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># for plotting</span>
  <span class="fu">mutate</span><span class="op">(</span>town <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">town</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PG"</span>, <span class="st">"QT"</span>, <span class="st">"TP"</span>,<span class="st">"JW"</span>, <span class="st">"BS"</span>, <span class="st">"WL"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>priority <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">priority</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Aves"</span>, <span class="st">"Lepidoptera"</span>, <span class="st">"Odonata"</span>,<span class="st">"Amphibia"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>round <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">round</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="images/sample-stacked-bar-plot.png" id="id" class="class" style="width:80.0%;height:80.0%" alt=""><p class="caption">Mean species richness (no. of species) per sampling point and survey, for each town and taxon. The error bars denote two standard deviations of the mean across all iterations. Note that the scale of the y-axis varies between the plots.</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># loop across all bootstrapped iterations</span>

<span class="va">plot_sac</span> <span class="op">&lt;-</span> 
  <span class="fu">foreach</span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">fauna</span><span class="op">)</span>, 
          .packages <span class="op">=</span> <span class="st">"tidyverse"</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
  
  <span class="va">unique</span> <span class="op">&lt;-</span> <span class="va">surveys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="va">town</span>, <span class="va">round</span>, <span class="va">priority</span><span class="op">)</span>
            
  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">unique</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    
    <span class="va">sac_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sac_extractor.html">sac_extractor</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">fauna</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, 
                              survey_ref <span class="op">=</span> <span class="va">surveys</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                              specify_town <span class="op">=</span> <span class="va">unique</span><span class="op">$</span><span class="va">town</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, 
                              specify_round <span class="op">=</span> <span class="va">unique</span><span class="op">$</span><span class="va">round</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, 
                              specify_priority <span class="op">=</span> <span class="va">unique</span><span class="op">$</span><span class="va">priority</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
    
    <span class="co"># bind to plot_sac &amp; overwrite</span>
    <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">%&gt;%</span>
      <span class="fu">bind_rows</span><span class="op">(</span><span class="va">sac_data</span><span class="op">)</span>
    
    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">sac_data</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">results</span>
<span class="op">}</span>

<span class="co"># unlist &amp; calc mean across iterations</span>
<span class="va">plot_sac</span> <span class="op">&lt;-</span> <span class="va">plot_sac</span> <span class="op">%&gt;%</span> 
  <span class="fu">map_dfr</span><span class="op">(</span><span class="op">~</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, .id <span class="op">=</span> <span class="st">"iteration"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>iteration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">iteration</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">town</span>, <span class="va">round</span>, <span class="va">priority</span>, <span class="va">sites</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">richness</span><span class="op">)</span>,
            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">richness</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="images/sac-sample-plot.png" id="id" class="class" style="width:80.0%;height:80.0%" alt=""><p class="caption">Species accumulation curves compare total, or â€˜gammaâ€™, diversity for the total sampling area, while accounting for differences in sampling effort. The mean species richness (line) and two standard deviations of the mean (shaded region) across all iterations are shown. Note that the scale of the y-axis varies between taxa.</p>
</div>
<div id="process-landscape-data" class="section level3">
<h3 class="hasAnchor">
<a href="#process-landscape-data" class="anchor"></a>3. Process landscape data</h3>
<p>Landscape information is retrieved from the publicly available Sentinel-2 database using the <code>sen2r</code> package. As this is an external package unrelated to <code>biodivercity</code>, please also refer to the official repository for updated instructions.</p>
<p>To model for fauna species richness across the six towns from 2016 to 2019, the spatio-temporal selections can be set accordingly to download all available Sentinel-2 images with the <code><a href="https://sen2r.ranghetti.info/reference/sen2r.html">sen2r()</a></code> GUI interface.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># http://sen2r.ranghetti.info/articles/installation.html</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"sen2r"</span><span class="op">)</span>

<span class="co"># install Sen2Cor software (atmospheric correction for Level-1C products)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sen2r.ranghetti.info">sen2r</a></span><span class="op">)</span>
<span class="fu"><a href="https://sen2r.ranghetti.info/reference/check_sen2r_deps.html">check_sen2r_deps</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># check dependencies</span>
<span class="fu"><a href="https://sen2r.ranghetti.info/reference/install_sen2cor.html">install_sen2cor</a></span><span class="op">(</span>force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># install via command instead of GUI</span>

<span class="va">out_dir</span>  <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{dir_dataoutput}/spatial/satellite-images/sen2r/sen2r_"</span>, <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">sen2r_date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">}</span>, <span class="st">"-to-"</span>, <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">sen2r_date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>

<span class="co"># run this after every successful download if there are still files in LTA not yet online, then subsequently check with provided safe_is_online() and sen2r():</span>
<span class="va">out_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sen2r.ranghetti.info/reference/sen2r.html">sen2r</a></span><span class="op">(</span>
  param_list <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">sen2r_params</span>,
  timewindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">sen2r_date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">sen2r_date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
  path_l2a <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">sen2r_dir_rawdata</span>, <span class="co"># level-2A SAFE products</span>
  path_l1c <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">sen2r_dir_rawdata</span>, <span class="co"># level-1C SAFE products</span>
  path_out <span class="op">=</span> <span class="va">out_dir</span>,
  path_indices <span class="op">=</span> <span class="va">out_dir</span>,
  extent_as_mask <span class="op">=</span> <span class="cn">TRUE</span>,
  list_rgb <span class="op">=</span> <span class="st">"RGB432B"</span> <span class="co"># output RGB image</span>
  <span class="co"># max_mask = 15,</span>
  <span class="co"># list_indices = c("NDVI", "ARI")</span>
  <span class="op">)</span></code></pre></div>
<p>After downloading the raster files within their specific index directories, we have to mosaic the individual images to account for data deficiencies from cloud cover.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/mosaic_sen2r.html">mosaic_sen2r</a></span><span class="op">(</span>parent_dir <span class="op">=</span> <span class="va">out_dir</span>,
              exclude <span class="op">=</span> <span class="cn">NULL</span>,
              rm_outlier <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>We then classify the resulting mosaics according to their respective indices. We use Otsuâ€™s thresholding (see article) to define threshold values where any value above the threshold is regarded as a presence of the landscape type measured by an index.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/classify_mosaic.html">classify_mosaic</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"out_dir/index/mosaic.tif"</span>,
                otsu <span class="op">=</span> <span class="cn">TRUE</span>,
                output <span class="op">=</span> <span class="st">"out_dir/classified/"</span><span class="op">)</span></code></pre></div>
<p>With the classified mosaics, we can isolate landscape metrics at a defined buffer distance around fauna sampling points. The sample datasets <code><a href="https://rdrr.io/r/utils/data.html">data(points)</a></code>, <code><a href="https://rdrr.io/r/utils/data.html">data(NDVI)</a></code> and <code><a href="https://rdrr.io/r/utils/data.html">data(NDWI2)</a></code> contains the survey points and the classified mosaics for NDVI and NDWI2.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">points</span><span class="op">)</span>
<span class="va">veg_classified</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">NDVI</span><span class="op">)</span>
<span class="va">water_classified</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">NDWI2</span><span class="op">)</span>

<span class="va">circles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lsm_perpoint.html">lsm_perpoint</a></span><span class="op">(</span>raster <span class="op">=</span> <span class="va">veg_classified</span>, points <span class="op">=</span> <span class="va">points</span>, 
                        buffer_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">126</span>, <span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">800</span>, <span class="fl">1000</span><span class="op">)</span>,
                        class_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"veg"</span><span class="op">)</span>,
                        class_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
                        landscape_name <span class="op">=</span> <span class="st">"veg"</span>,
                        level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span><span class="op">)</span> 

<span class="va">circles2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lsm_perpoint.html">lsm_perpoint</a></span><span class="op">(</span>raster <span class="op">=</span> <span class="va">water_classified</span>, points <span class="op">=</span> <span class="va">points</span>, 
                        buffer_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">126</span>, <span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">800</span>, <span class="fl">1000</span><span class="op">)</span>,
                        class_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"water"</span><span class="op">)</span>,
                        class_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
                        landscape_name <span class="op">=</span> <span class="st">"water"</span>,
                        level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span><span class="op">)</span> 

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">circles</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># append to circles2 info to circles</span>
  <span class="va">circles</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">circles</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span>
    <span class="fu">full_join</span><span class="op">(</span><span class="va">circles2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> 
                 <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"lsm_"</span><span class="op">)</span>, 
                  <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">percentage_inside</span> <span class="op">&lt;</span> <span class="fl">90</span>, <span class="cn">NA</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
                <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">percentage_inside</span><span class="op">)</span>, 
              by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point_id"</span>, <span class="st">"round"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Next, urban landscape elements are retrieved from the freely-available OpenStreetMap (OSM) database. In the Sentinel-2 images, buildings would be represented by their building footprint as opposed to three-dimensional structures. We can download the number of above-ground levels as a proxy for building height, especially in residential buildings where the floor-to-floor height is standardised (Building height data may also be supplied by government databases if available (e.g.Â <a href="https://data.gov.sg/dataset/hdb-property-information">HDB Property Information from data.gov.sg</a>).). Building polygons and road lines are extracted from a set geographical boundary with the functions <code>get_buildings_osm</code> and <code>get_roads_osm</code>. <code>home2park</code>, a GitHub package, and <code>osmextract</code> are required dependencies for these functions and this package.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">osm_boundaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">boundaries</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># st_union() %&gt;% # merge all subzones</span>
  <span class="fu">st_as_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">st_make_valid</span><span class="op">(</span><span class="op">)</span>

<span class="co"># get_roads_osm is not in home2park package. Need to load dependency libraries</span>

<span class="fu">foreach</span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">osm_download_dates</span><span class="op">)</span>, 
                   .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"home2park"</span>,
                                 <span class="st">"tidyverse"</span>, <span class="st">"sf"</span>, <span class="st">"osmextract"</span><span class="op">)</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span> 
  
  <span class="co"># buildings                   </span>
  <span class="fu"><a href="../reference/get_buildings_osm.html">get_buildings_osm</a></span><span class="op">(</span><span class="va">osm_boundaries</span>, 
                    date <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">osm_download_dates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
                    dir_raw <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">osm_dir_rawdata</span>,
                    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">dir_dataoutput</span>, <span class="st">"/landscape/osm/buildings_osm-polygons_"</span>, <span class="va">params</span><span class="op">$</span><span class="va">osm_download_dates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".geojson"</span><span class="op">)</span><span class="op">)</span>
              
  <span class="co"># roads</span>
  <span class="fu"><a href="../reference/get_roads_osm.html">get_roads_osm</a></span><span class="op">(</span><span class="va">osm_boundaries</span>, 
                date <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">osm_download_dates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
                dir_raw <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">osm_dir_rawdata</span>,
                filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">dir_dataoutput</span>, <span class="st">"/landscape/osm/roads_osm-lines_"</span>, <span class="va">params</span><span class="op">$</span><span class="va">osm_download_dates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".geojson"</span><span class="op">)</span><span class="op">)</span>       
                     
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>                   
<span class="op">}</span></code></pre></div>
</div>
<div id="building-of-models" class="section level3">
<h3 class="hasAnchor">
<a href="#building-of-models" class="anchor"></a>4. Building of models</h3>
<p>To be added.</p>
</div>
<div id="spatial-predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#spatial-predictions" class="anchor"></a>5. Spatial predictions</h3>
<p><code>geom_to_grid</code> overlays a grid over a target area where species richness predictions are desired. This function is a wrapper for the <code>st_make_grid</code> function with <code>what == "centers"</code>, from the package <code>sf</code>. The output is an object of class <code>sfc</code> that comprise of points at which landscape metrics are extracted from their respective distance buffers. Grid dimensions are variable and can be specified with <code>grid_dim</code>. <code>buffer_dist</code> is an optional argument for situations where landscape data is limited to the target area or smaller. The distance value for this argument should correspond to the largest buffer present in the variables, so as to not include areas with no landscape data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># subset to regions where predictions can be made: &gt;126m inwards from boundaries</span>
<span class="va">bound_grid</span> <span class="op">&lt;-</span> <span class="fu">geom_to_grid</span><span class="op">(</span>geom <span class="op">=</span> <span class="va">bound</span>,
                           buffer_dist <span class="op">=</span> <span class="fl">126</span>,
                           grid_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="images/geom-to-grid.png" id="id" class="class" style="width:60.0%;height:60.0%" alt=""><p class="caption">Visualisation of the <code>geom_to_grid</code> function.</p>
</div>
<p>The <code>heatmap_raster</code> function is a combination of multiple functions that result in a final raster of species richness predictions for one taxon. A breakdown of the function is as follows:</p>
<ol style="list-style-type: decimal">
<li>Species richness is predicted at each point provided in the <code>geom</code> argument with the objects specified in <code>mods</code>, <code>env_df</code> and <code>landscape</code>.</li>
<li>A second grid is created using <code>st_make_grid</code> with <code>what == "polygons"</code> as a template for the final raster.</li>
<li>The grid template and prediction values are combined with <code>rasterize</code> from the <code>terra</code> package.</li>
</ol>
<p><strong>Note</strong>: Variables used in <code>landscape</code> should match variables in <code>env_df</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Minor edits to the env_df had to be made</span>
<span class="co"># bird_env &lt;- birds %&gt;% </span>
<span class="co">#   dplyr::select(where(is.numeric) &amp; !sprich) %&gt;% </span>
<span class="co">#   dplyr::select(!r50m_man_GnPR) # non-GnPR dataset</span>

<span class="va">bird_hm</span> <span class="op">&lt;-</span> <span class="fu">heatmap_raster</span><span class="op">(</span>env_df <span class="op">=</span> <span class="va">bird_env</span>,
                          mods <span class="op">=</span> <span class="va">birdmods</span>,
                          landscape <span class="op">=</span> <span class="va">grid_landscape</span>,
                          geom <span class="op">=</span> <span class="va">bound</span>,
                          buffer_dist <span class="op">=</span> <span class="fl">126</span>,
                          grid_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>,
                          name <span class="op">=</span> <span class="st">"bird_hm"</span><span class="op">)</span> <span class="co"># optional</span></code></pre></div>
</div>
<div id="cross-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#cross-validation" class="anchor"></a>Cross-validation</h3>
<p>To be added.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
