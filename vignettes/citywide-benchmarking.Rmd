---
title: "Citywide Benchmarking"
subtitle: "Predict and compare animal diversity across zones used in city planning"
author: "Song, Xiao Ping"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Citywide Benchmarking}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r load biodivercity while in dev, include = FALSE}
devtools::load_all()
library("sf")
library("dplyr")
library("tmap")
```


Pixel-based spatial predictions of animal diversity from the predictive models enable fine-grained assessments of the landscape, by providing continuous values at a specified spatial resolution. Pixel values can also be summarised within the zones used in city planning, to allow comparisons to be made between these planning units. This enables animal diversity to be assessed alongside other indices also summarised at the level of these planning units, providing a more comprehensive view when performing citywide benchmarking of components related to biodiversity and beyond.  

For example, the availability of citywide landscape data allow us to predict the local diversity of odonates across all [subzones](https://data.gov.sg/dataset/master-plan-2019-subzone-boundary-no-sea) in Singapore: 

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=2.6, fig.height = 2.0, dpi = 300, out.width="100%", fig.cap = "**Map: Spatial predictions of odonate diversity within subzones in Singapore.** The pixel resolution used for predictions in this example is 1 km; subzones that are too small for this pixel resolution do not have predicted values."}

sg_subzones <- 
  system.file("extdata", "sg_subzones.geojson", package="biodivercity") %>% 
  read_sf() %>% 
  relocate("subzone_n")

heatmap_dragons <- 
  system.file("extdata", "alpha-diversity_dragons_subzones_1000m.tif", package="biodivercity") %>% 
  terra::rast()


tmap_mode("view")
tm_basemap(c("CartoDB.Positron")) +
  tm_shape(sg_subzones) +
    tm_polygons(group = "Singapore Subzones",
                alpha = 0) +
  tm_shape(heatmap_dragons, raster.downsample = FALSE) +
    tm_raster(group = "Local diversity: Odonates",
              title = "Number of odonate species",
              style = "pretty",
              n = 8,
              palette = "YlOrRd",
              alpha = 0.6)
  
  
```

<center>
**Map: Spatial predictions of odonate diversity within subzones in Singapore.** The pixel resolution used for predictions in this example is 1 km; subzones were analysed separately, and those with an area too small for this pixel resolution do not have predicted values.
</center>

<br>

The pixel values can be summarised per subzone, and the distribution of the summarised values can subsequently be used to compare the ‘performance’ of each subzone relative to others in Singapore, or to a set benchmark/target for the desired level of 'performance' of each planning unit. For example, towns could be scored based on their performance relative to the mean of the distribution, as shown below:

```{r out.width = "60%", fig.align='center', dpi = 300, echo = FALSE, fig.cap = "**Figure: Histograms showing the distribution of values for the mean number of odonate species per pixel within each of the 332 subzones in Singapore.** The pixel resolution used for predictions in this example is 1 km."}
knitr::include_graphics("subzone-distribution-odonates.png", dpi = 300)
```

<br>

In the above example, each subzone was assigned an arbitrary score of 0-4, based on standard deviations from the mean (i.e., performance of the 'average' subzone). If predictions were made for multiple snapshots in time, scoring could be based on whether the mean pixel value for a particular subzone increases or decreases between two time periods; subzones could then be assigned a negative or positive score, for instance, based on a target of 'no net loss' over time.


<br>

---

## References

Government of Singapore (2020). [Master Plan 2019 Subzone Boundary (No Sea)](https://data.gov.sg/dataset/master-plan-2019-subzone-boundary-no-sea). _data.gov.sg_
Released under the terms of the [Singapore Open Data Licence version 1.0](https://data.gov.sg/open-data-licence).



