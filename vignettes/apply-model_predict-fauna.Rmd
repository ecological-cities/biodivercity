---
title: "Predict fauna spatially"
author: "Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
navbar: ~
vignette: >
  %\VignetteIndexEntry{Predict fauna spatially}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

- `summarise_landscape_perpt.R`
- `geom_to_grid.R`
- `heatmap_raster.R`

## Creating landscape metrics dateframe for heatmap predictions

Creating a grid (**ATTN**: This is the function of `geom_to_grid.R` (untested))
```{r create grid for each UGS town, eval = FALSE}
# subset to regions where predictions can be made: >126m inwards from boundaries
bound_diff <- st_buffer(bound, dist = -126)

bound_grid <- bound_diff %>% 
  st_make_grid(cellsize = params$grid_dim, # regular grid across entire region
               what = "centers", square = T, 
               crs = st_crs(bound)) %>% 
  st_intersection(bound_diff) %>% # subset to only within regions of interest
  st_as_sf() %>% 
  st_join(bound_diff) # add back col info
  
```

**Note**: This function is made for manually-mapped landscape data. For Sentinel-2 mosaic rasters, `lsm_perpoint.R` should work (untested)
```{r run function to summarise landscape vars per grid point, eval = FALSE}
bound_grid <- bound_grid %>% 
  group_by(sites) %>% 
  mutate(id = row_number()) %>% 
  mutate(site_id = paste0(sites, id)) %>% 
  dplyr::select(sites, site_id, geometry) %>% 
  ungroup()

grid_landscape <-
  summarise_landscape_perpt(
    points = bound_grid,
    uid_column = "site_id",
    species = "species",
    layer_trees = trees, radii_trees = 50,
    layer_shrubs = shrubs, radii_shrubs = 50,
    layer_turf = turf, radii_turf = 50,
    layer_natveg = natveg, radii_natveg = c(50, 126),
    layer_water = water, radii_water = 50,
    layer_buildings = buildings, radii_buildings = 50, buildings_levels = "building_l",
    layer_roads = roads, radii_roads = c(50, 126), roads_lanes = "lanes")
```

## Rasterising predictions

**ATTN**: `heatmap_raster.R` is untested
